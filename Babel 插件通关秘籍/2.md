### declare 用法

- babel7 的插件兼容写法: 使用 declare 包裹
- 插件函数
  - 返回值
    - visitor： traverse 时调用的函数。
    - pre、post：遍历前后调用
  - 参数
    - api, 包含 babel 的 api，如 types、template 等

```javascript
const { declare } = require("@babel/helper-plugin-utils");

// 函数plugin
const autoTrackPlugin = declare((api, options, dirname) => {
  api.assertVersion(7);

  return {
    pre(file) {},
    visitor: {
      // 遍历的时候指定 visitor 处理的 AST
      Program: {
        // 遍历当前节点的子节点前调用
        enter(path, state) {},
        // 遍历完当前节点的子节点后调用
        exit(path, state) {},
      },
      // 相当于是 enter 时调用的函数
      Identifier(path, state) {},
    },
    post(file) {},
  };
});
module.exports = autoTrackPlugin;
```

### Traver

- 插件的 visitor
- path
  - traverse(visitor, state) 遍历当前节点的子节点，传入 visitor 和 state
  - node 属性：当前 AST 节点
  - scope 属性： 作用域
    - generateUid(name) 生成作用域内唯一名字
- state
  - 遍历过程中 AST 节点之间传递数据的方式

### babel 的 API

- parse
  - @babel/parser
- transform
  - @babel/traverse 遍历 AST
  - @babel/types 判断、创建、修改 AST
  - @babel/template 简化 AST 创建

```javascript
const ast = template.ast(code, [opts]);
```

- generate
  - @babel/generate
- @babel/core
  - babel 的整体功能
